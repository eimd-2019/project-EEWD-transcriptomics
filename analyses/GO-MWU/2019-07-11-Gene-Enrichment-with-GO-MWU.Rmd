---
title: "Gene Enrichment with GO-MWU"
author: "Yaamini Venkataraman"
date: "7/11/2019"
output: github_document
---

In this R Markdown file, we will perform a gene enrichment with [GO-MWU](https://github.com/z0on/GO_MWU). This is a rank-based gene enrichment method using a Mann-Whitney U test that works well with non-model organisms. There are separate annotations for *Zostera marina* and *Labyrinthula zosterae*, so these files will be formatted separately.

# Set up R Markdown document

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
sessionInfo() #Obtain session information.
```

# Obtain go.obo database

```{bash}
curl http://purl.obolibrary.org/obo/go.obo > go.obo #curl database from permanent url
```

#Format GO-MWU input

## GO annotations table

The GO annotation tables need to be tab-delimited with 2 columns: gene ID and GOterms separated by semicolons.

### *Z. marina*

```{r}
allZosteraAnnotations <- read.delim("../../data/Zostera-blast-annot-withGeneID-noIsoforms-geneCounts.tab", header = FALSE) #Import file with gene counts for annotated genes
colnames(allZosteraAnnotations) <- c("GeneID", "Accession", "Isoform", "E-value", "ProteinN", "GO_BP", "GO_CC", "GO_MF", "GO", "Status", "Organism", "S_10B", "S_9A", "S_13A", "S_42A", "S_46B", "S_47B", "S_48B", "S_2A", "S_2B", "S_7B", "S_8B", "S_33A", "S_36B", "S_38A", "S_40A") #Rename columns
head(allZosteraAnnotations) #Confirm changes
```

```{r}
zosteraGOAnnotationsTable <- data.frame(allZosteraAnnotations$GeneID,
                                        allZosteraAnnotations$GO) #Save gene ID and all gene ontology terms in a new dataframe
head(zosteraGOAnnotationsTable) #Confirm format is good for GO-MWU. It is.
```

```{r}
write.table(zosteraGOAnnotationsTable, "2019-07-11-Zostera-GO-Annotations-Table.txt", sep = "\t", col.names = FALSE, row.names = FALSE) #Save file
```

### *L. zosterae*

```{r}
allnonZosteraAnnotations <- read.delim("../../data/nonZostera-blast-annot-withGeneID-noIsoforms-geneCounts.tab", header = FALSE) #Import file with gene counts for annotated genes
colnames(allnonZosteraAnnotations) <- c("GeneID", "Accession", "Isoform", "E-value", "ProteinN", "GO_BP", "GO_CC", "GO_MF", "GO", "Status", "Organism", "S_10B", "S_9A", "S_13A", "S_42A", "S_46B", "S_47B", "S_48B", "S_2A", "S_2B", "S_7B", "S_8B", "S_33A", "S_36B", "S_38A", "S_40A") #Rename columns
head(allnonZosteraAnnotations) #Confirm changes
```

```{r}
nonZosteraGOAnnotationsTable <- data.frame(allnonZosteraAnnotations$GeneID,
                                           allnonZosteraAnnotations$GO) #Save gene ID and all gene ontology terms in a new dataframe
head(nonZosteraGOAnnotationsTable) #Confirm format is good for GO-MWU. It is.
```

```{r}
write.table(nonZosteraGOAnnotationsTable, "2019-07-11-nonZostera-GO-Annotations-Table.txt", sep = "\t", col.names = FALSE, row.names = FALSE) #Save file
```

## Table of significance measures

The table of significance measures needs to be a CSV file with two columns: gene ID and measure of continuous significance. Similar to the GO-MWU README, I used signed negative log p-values. These p-values are from `edgeR` output.

### *Z. marina*

### *L. zosterae*